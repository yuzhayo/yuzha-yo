# üìö Variant Layer System - Quick File Reference

## üéØ **ESSENTIAL FILES** (Core System)

| File | Purpose | Key Exports |
|------|---------|-------------|
| **`LayerProducer.ts`** | ‚≠ê **Main pipeline orchestrator** | `produceFrame()`, `ProduceInput`, `ProduceOutput`, `Renderable` |
| **`LayerLogicBasic.ts`** | ‚≠ê **Foundation transforms** | `computeBasicState()`, `resolveFinalAngle()`, `BasicConfig` |
| **`LayerLogicSpin.ts`** | ‚≠ê **Rotation behavior** | `getSpinAngleDeg()`, `computeSpinState()`, `SpinConfig` |
| **`LayerLogicOrbit.ts`** | ‚≠ê **Orbital motion** | `computeOrbitState()`, `getOrbitOrientationDeg()`, `OrbitConfig` |
| **`LayerLogicClock.ts`** | ‚≠ê **Time-based logic** | `getClockDrivenImageAngle()`, `computeClockState()`, `ClockConfig` |

## üìÅ **BY CATEGORY**

### **üèóÔ∏è Core Pipeline Architecture**
```
/app/old/variant/
‚îú‚îÄ‚îÄ LayerProducer.ts            ‚≠ê Main orchestration pipeline
‚îú‚îÄ‚îÄ index.ts                    üì¶ Barrel exports (clean imports)
‚îî‚îÄ‚îÄ LayerConverter.ts           üîÑ JSON ‚Üî TypeScript mapping utilities
```

### **üß† Logic Processing Modules**
```
/app/old/variant/
‚îú‚îÄ‚îÄ LayerLogicBasic.ts          ‚≠ê Foundation layer (position/scale/angle)
‚îú‚îÄ‚îÄ LayerLogicSpin.ts           üîÑ Rotation/spinning behavior
‚îú‚îÄ‚îÄ LayerLogicOrbit.ts          üåç Orbital motion behavior  
‚îú‚îÄ‚îÄ LayerLogicClock.ts          üïê Time-based angle calculations
‚îî‚îÄ‚îÄ LayerLogicEffect.ts         ‚ú® Visual effects (fade/pulse/shake/etc)
```

### **‚öôÔ∏è Configuration System**
```
Configuration Files (JSON):
‚îú‚îÄ‚îÄ basic.config.json           üìù Position, scale, anchoring presets
‚îú‚îÄ‚îÄ spin.config.json            üîÑ Rotation speed, direction presets
‚îú‚îÄ‚îÄ orbit.config.json           üåç Orbital motion path presets
‚îú‚îÄ‚îÄ clock.config.json           üïê Timezone, tick mode presets
‚îú‚îÄ‚îÄ effect.config.json          ‚ú® Visual effect combinations
‚îî‚îÄ‚îÄ configs.all.json            üìä Combined configuration (all modules)
```

## üöÄ **START HERE FOR UNDERSTANDING**

### **üìñ Reading Order (Recommended)**
1. **`variant-system-analysis.md`** - Read complete technical analysis first
2. **`LayerProducer.ts`** - Understand the main pipeline orchestration
3. **`LayerLogicBasic.ts`** - Study foundation transform system
4. **Configuration JSONs** - See practical usage examples
5. **`LayerLogicSpin.ts`** - Learn rotation/angle override system  
6. **`LayerLogicOrbit.ts`** - Understand position override mechanics
7. **`LayerLogicClock.ts`** - Study time-based integration
8. **`LayerLogicEffect.ts`** - Learn visual post-processing

### **üîß For Implementation**
1. **`LayerProducer.ts`** - Main integration patterns and pipeline flow
2. **`LayerConverter.ts`** - JSON validation and mapping utilities
3. **Configuration files** - Real-world usage examples and presets
4. **`index.ts`** - Clean import/export structure
5. **Individual Logic Modules** - Specific behavior implementation details

### **‚ö° For Quick Reference**
1. **`variant-file-relationships.md`** - Architecture overview and data flow
2. **Type definitions** - Interfaces across all modules
3. **Configuration schemas** - JSON structure examples
4. **Priority systems** - Angle and position override rules

## üéØ **MOST IMPORTANT FILES** (Priority Order)

| Priority | File | Why Critical |
|----------|------|--------------|
| **ü•á #1** | `LayerProducer.ts` | Main pipeline - orchestrates entire processing flow |
| **ü•à #2** | `LayerLogicBasic.ts` | Foundation system - all other modules build on this |
| **ü•â #3** | `variant-system-analysis.md` | Complete understanding guide (technical deep-dive) |
| **4** | `LayerLogicSpin.ts` | Angle override system - demonstrates priority mechanics |
| **5** | Configuration JSONs | Real usage examples - shows practical implementation |
| **6** | `LayerLogicOrbit.ts` | Position override system - complex coordinate calculations |

## üìã **FILE MODIFICATION GUIDELINES**

### **üéØ Core Logic Modifications**
- **Basic Transforms**: Edit `LayerLogicBasic.ts` ‚Üí position/scale/anchor calculations
- **Angle Priority**: Edit `resolveFinalAngle()` ‚Üí Clock > Spin > Manual hierarchy  
- **Pipeline Flow**: Edit `LayerProducer.ts` ‚Üí processing order and data flow
- **Effect Processing**: Edit `LayerLogicEffect.ts` ‚Üí visual post-processing

### **üîß Behavior Extensions**
- **New Logic Module**: Create `LayerLogic[Name].ts` following existing patterns
- **Pipeline Integration**: Add to `ProduceInput` interface and `produceFrame()` flow
- **Configuration**: Create corresponding `[name].config.json` with presets
- **Type System**: Extend interfaces in respective modules

### **‚öôÔ∏è Configuration Changes**
- **Presets**: Add new presets to existing JSON configs
- **Structure**: Extend config interfaces in respective TypeScript modules
- **Validation**: Update `LayerConverter.ts` for new fields/structures
- **Documentation**: Update examples in configuration files

## üéÆ **MODULE INTERACTION PATTERNS**

### **üîÑ Processing Chain**
```
LayerBasic (Foundation)
    ‚Üì (provides base transforms)
LayerSpin (Angle Override)
    ‚Üì (can override manual angle)
LayerOrbit (Position Override)  
    ‚Üì (replaces position, suggests orientation)
LayerClock (Time Integration)
    ‚Üì (can override all angles with time-based)
LayerEffect (Post-Processing)
    ‚Üì (modifies final values)
Renderable Output
```

### **üìä Priority Systems**
```
ANGLE PRIORITY: Clock > Spin > Manual > Orbit Suggestion
POSITION FLOW: Basic ‚Üí Orbit Override ‚Üí Effect Nudges
TIME INTEGRATION: Clock ‚Üî Spin (inheritance via imageSpin)
ORIENTATION MODES: Orbit ‚Üí Spin (inheritSpin mode)
```

### **üéØ Configuration Dependencies**
```
Canvas Size ‚Üí Basic (fraction positions)
Basic Position ‚Üí Orbit (auto-inference)  
Spin State ‚Üí Clock (imageSpin inheritance)
Spin State ‚Üí Orbit (orientation inheritance)
All Configs ‚Üí Producer (main pipeline)
```

## üí° **QUICK INTEGRATION EXAMPLES**

### **Basic Pipeline Usage**
```typescript
import { produceFrame } from "./LayerProducer";

const result = produceFrame({
  canvasSizePx: { x: 512, y: 512 },
  basic: basicConfig,
  spin: spinConfig, 
  orbit: orbitConfig,
  clock: clockConfig,
  effect: effectConfig,
});

// result.renderable ‚Üí ready for any renderer
```

### **Individual Module Usage**
```typescript
import { computeBasicState } from "./LayerLogicBasic";
import { getSpinAngleDeg } from "./LayerLogicSpin";

const basic = computeBasicState(config, canvasSize);
const spinAngle = getSpinAngleDeg(spinConfig);
```

### **Configuration Loading**
```typescript
import allConfigs from "./configs.all.json";
import { fromJson } from "./LayerConverter";

const configs = fromJson(allConfigs);
const result = produceFrame(configs);
```

## üìñ **ANGLE CONVENTION REFERENCE**

### **Universal Standard**
- **Range**: 0-360¬∞ (normalized)
- **Zero Point**: 0¬∞ = Right/East
- **Up Direction**: 90¬∞ = Up/North  
- **Rotation**: Clockwise = Positive
- **Functions**: All modules use `normalize360(deg)`

### **Practical Examples**
```
  90¬∞ (Up)
    ‚Üë
180¬∞ ‚Üê ‚Üí 0¬∞ (Right)  
    ‚Üì
 270¬∞ (Down)

Common Values:
- Right: 0¬∞
- Up: 90¬∞ 
- Left: 180¬∞
- Down: 270¬∞
```

## üé® **EFFECT TYPES REFERENCE**

| Effect | Purpose | Key Parameters |
|--------|---------|----------------|
| **Fade** | Opacity transitions | `from`, `to`, `durationMs`, `easing` |
| **Pulse** | Scale/opacity breathing | `freqHz`, `waveform`, `scaleAmp`, `opacityAmp` |
| **Blink** | On/off visibility | `freqHz`, `duty`, `onOpacity`, `offOpacity` |
| **Shake** | Position jitter | `posAmp`, `angleAmpDeg`, `freqHz` |
| **Wiggle** | Micro rotations | `angleAmpDeg`, `posAmp`, `freqHz`, `waveform` |

## üîç **COMPARISON WITH OTHER SYSTEMS**

| Aspect | Launcher System | Upgraded System | Variant System |
|--------|----------------|-----------------|----------------|
| **Architecture** | Monolithic Pixi.js | Modular Three.js | Pure TypeScript Logic |
| **Rendering** | 2D Canvas (Pixi) | 3D WebGL (Three) | Renderer-Agnostic |
| **Stage Size** | 1024√ó1024 fixed | 2048√ó2048 adaptive | Canvas-size flexible |
| **Logic Flow** | Imperative/Mixed | Object-Oriented | Pure Functional |
| **Configuration** | Runtime mixing | Validation system | JSON + TypeScript |
| **Effects** | Basic built-ins | GPU accelerated | Math-based pure functions |
| **Time Handling** | Basic animation | Performance adaptive | Precise time injection |

## üéØ **EXTENSION GUIDELINES**

### **‚úÖ Easy to Extend**
- Add new effect types in `LayerLogicEffect.ts`
- Create new configuration presets in JSON files  
- Add utility functions in individual modules
- Extend type definitions with new interfaces

### **‚ö†Ô∏è Moderate Complexity**
- Add new logic modules (requires pipeline integration)
- Modify angle priority system (affects multiple modules)
- Change coordinate conventions (system-wide impact)
- Add new renderer integration patterns

### **üîí Core Architecture (Be Careful)**  
- Pipeline execution order in `LayerProducer.ts`
- Basic foundation system in `LayerLogicBasic.ts`
- Cross-module type dependencies
- Configuration validation in `LayerConverter.ts`

This file structure represents a **pure, functional layer processing system** designed for maximum flexibility, testability, and integration with any rendering system while maintaining clean separation of concerns and predictable behavior.