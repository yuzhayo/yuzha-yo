# üìö Upgraded Layer System - Quick File Reference

## üéØ **ESSENTIAL FILES** (Core System)

| File | Purpose | Key Exports |
|------|---------|-------------|
| **`StagesEngine.ts`** | ‚≠ê **Main public API entry point** | `StagesEngine` class, `mount()`, `setObject()` |
| **`StagesLogic.ts`** | ‚≠ê **Coordination layer & library export** | `StagesLogic` class, module coordination |
| **`StagesLogicDevice.ts`** | ‚≠ê **Performance intelligence** | `StagesLogicDevice`, device tier detection |
| **`StagesLogicTransform.ts`** | ‚≠ê **Coordinate transformation system** | `STAGE_WIDTH/HEIGHT`, coordinate conversion |
| **`StagesRenderer.ts`** | ‚≠ê **Three.js WebGL rendering** | `StagesRenderer`, scene management |

## üìÅ **BY CATEGORY**

### **üèóÔ∏è Core Engine Architecture**
```
/app/merge/upgraded/
‚îú‚îÄ‚îÄ StagesEngine.ts                 ‚≠ê Main API (public interface)
‚îú‚îÄ‚îÄ StagesLogic.ts                  ‚≠ê Coordination layer & exports
‚îú‚îÄ‚îÄ StagesEngineObjects.ts          üì¶ Object lifecycle management
‚îú‚îÄ‚îÄ StagesEngineEvents.ts           üéØ Event handling system
‚îî‚îÄ‚îÄ useLayerEngine.ts               ‚öõÔ∏è React integration hook
```

### **üß† Logic Processing Modules (StagesLogic Children)**
```
/app/merge/upgraded/
‚îú‚îÄ‚îÄ StagesLogicDevice.ts            üîç GPU/memory device intelligence
‚îú‚îÄ‚îÄ StagesLogicTransform.ts         üìê Coordinate system & scaling
‚îú‚îÄ‚îÄ StagesLogicPerformance.ts       üìä FPS monitoring & adaptive quality
‚îú‚îÄ‚îÄ StagesTypes.ts                  üìù Type definitions for logic system
‚îî‚îÄ‚îÄ StagesRenderer.ts               üé® Three.js WebGL integration
```

### **üé® Rendering System (Three.js)**
```
/app/merge/upgraded/
‚îú‚îÄ‚îÄ StagesRenderer.ts               üé® Main Three.js renderer
‚îú‚îÄ‚îÄ StagesRendererMesh.ts           üî∫ Geometry & mesh management
‚îú‚îÄ‚îÄ StagesRendererMaterial.ts       üé≠ Material & texture system
‚îî‚îÄ‚îÄ StagesTypes.ts                  üìù Rendering type definitions
```

### **‚öôÔ∏è Layer Processing Pipeline**
```
/app/merge/upgraded/
‚îú‚îÄ‚îÄ LayerPipeline.ts                üîÑ Processing orchestration
‚îú‚îÄ‚îÄ LayerProducer.ts                üè≠ Layer production system
‚îú‚îÄ‚îÄ LayerValidator.ts               ‚úÖ Configuration validation
‚îú‚îÄ‚îÄ LayerConverter.ts               üîÑ JSON ‚Üî TypeScript mapping
‚îú‚îÄ‚îÄ LayerTypes.ts                   üìã Layer system types
‚îú‚îÄ‚îÄ LayerImageResolver.ts           üñºÔ∏è Asset resolution system
‚îî‚îÄ‚îÄ LayerMappingImage.ts            üìç Image coordinate mapping
```

### **üéõÔ∏è Layer Logic Behaviors**
```
/app/merge/upgraded/
‚îú‚îÄ‚îÄ LayerLogicBasic.ts              ‚≠ê Foundation transforms
‚îú‚îÄ‚îÄ LayerLogicSpin.ts               üîÑ Rotation behaviors
‚îú‚îÄ‚îÄ LayerLogicOrbit.ts              üåç Orbital motion
‚îú‚îÄ‚îÄ LayerLogicClock.ts              üïê Time-based behaviors
‚îú‚îÄ‚îÄ LayerLogicPulse.ts              üíì Scale pulsing effects
‚îî‚îÄ‚îÄ LayerLogicFade.ts               üå´Ô∏è Opacity animations
```

### **üéØ React Integration & Configuration**
```
/app/merge/upgraded/
‚îú‚îÄ‚îÄ LayerReactStage.tsx             üì± React stage component
‚îú‚îÄ‚îÄ useLayerEngine.ts               ‚öõÔ∏è Engine integration hook
‚îú‚îÄ‚îÄ LayerAdapterStages.ts           üîó Stages system adapter
‚îú‚îÄ‚îÄ LayerMappingScreen.ts           üì± Screen coordinate mapping
‚îî‚îÄ‚îÄ mainconfig.json                 ‚öôÔ∏è Default configuration
```

## üöÄ **START HERE FOR UNDERSTANDING**

### **üìñ Reading Order (Recommended)**
1. **`upgraded-system-analysis.md`** - Read complete technical analysis first
2. **`StagesEngine.ts`** - Understand main public API structure
3. **`StagesLogic.ts`** - Study coordination layer and library exports
4. **`StagesLogicDevice.ts`** - Learn device intelligence and performance tiers
5. **`StagesLogicTransform.ts`** - Study 2048√ó2048 coordinate system
6. **`StagesRenderer.ts`** - Understand Three.js integration
7. **`LayerPipeline.ts`** - Learn layer processing orchestration
8. **Individual Layer Logic modules** - Study specific behaviors

### **üîß For Implementation**
1. **`StagesEngine.ts`** - Main integration patterns and public API
2. **`StagesLogic.ts`** - Library structure and module coordination
3. **Device Intelligence modules** - Performance optimization patterns
4. **Rendering System modules** - Three.js integration patterns
5. **Layer Processing modules** - Configuration-driven behavior system
6. **React Integration modules** - Component patterns and hooks

### **‚ö° For Quick Reference**
1. **`upgraded-file-relationships.md`** - Architecture overview and data flow
2. **`StagesTypes.ts`** - Core type definitions and interfaces
3. **`LayerTypes.ts`** - Layer system type definitions
4. **`mainconfig.json`** - Configuration examples and defaults
5. **Performance optimization settings** - Device tier configurations

## üéØ **MOST IMPORTANT FILES** (Priority Order)

| Priority | File | Why Critical |
|----------|------|--------------|
| **ü•á #1** | `StagesEngine.ts` | Main public API - entry point for all functionality |
| **ü•à #2** | `StagesLogic.ts` | Coordination layer - manages all child logic modules |
| **ü•â #3** | `upgraded-system-analysis.md` | Complete understanding guide (technical deep-dive) |
| **4** | `StagesLogicDevice.ts` | Device intelligence - critical for Android performance |
| **5** | `StagesLogicTransform.ts` | Coordinate system - 2048√ó2048 mathematical foundation |
| **6** | `StagesRenderer.ts` | Three.js integration - WebGL rendering system |

## üìã **FILE MODIFICATION GUIDELINES**

### **üéØ Core System Modifications**
- **Public API**: Edit `StagesEngine.ts` ‚Üí main interface changes
- **Coordination Logic**: Edit `StagesLogic.ts` ‚Üí module coordination updates
- **Device Intelligence**: Edit `StagesLogicDevice.ts` ‚Üí performance tier rules
- **Transform System**: Edit `StagesLogicTransform.ts` ‚Üí coordinate algorithms
- **Rendering**: Edit `StagesRenderer.ts` ‚Üí Three.js integration changes

### **üîß Logic Module Extensions**
- **New Device Rules**: Extend `DeviceDetectionRules` class
- **New Transform Modes**: Add to `TransformRules` class
- **New Performance Metrics**: Extend `StagesLogicPerformance.ts`
- **New Layer Behaviors**: Create `LayerLogic[Name].ts` following existing patterns
- **New Event Types**: Extend `StagesEngineEvents.ts`

### **‚öôÔ∏è Layer System Changes**
- **Pipeline Processing**: Edit `LayerPipeline.ts` ‚Üí behavior orchestration
- **Configuration Validation**: Edit `LayerValidator.ts` ‚Üí input validation rules
- **Type Definitions**: Update `LayerTypes.ts` or `StagesTypes.ts`
- **Asset Resolution**: Edit `LayerImageResolver.ts` ‚Üí image loading logic

## üéÆ **SYSTEM INTERACTION PATTERNS**

### **üîÑ Engine Coordination**
```
StagesEngine (Public API)
    ‚Üì coordinates
StagesLogic (Coordination Layer)
    ‚Üì manages
Child Modules (Device/Transform/Performance/Renderer)
    ‚Üì notify back
Update Callbacks (Device changes, Performance adjustments)
```

### **üìä Performance Intelligence**
```
Device Detection ‚Üí Performance Tier ‚Üí Quality Settings ‚Üí Renderer Configuration
StagesLogicDevice ‚Üí StagesLogicPerformance ‚Üí RenderQuality ‚Üí StagesRenderer
```

### **üìê Coordinate Pipeline**
```
Browser Events ‚Üí Viewport Coordinates ‚Üí Stage Coordinates ‚Üí World Coordinates
StagesEngineEvents ‚Üí StagesLogicTransform ‚Üí Three.js Scene Objects
```

### **üé® Rendering Chain**
```
Stage Objects ‚Üí Mesh Creation ‚Üí Material Application ‚Üí Scene Rendering
StagesEngineObjects ‚Üí StagesRendererMesh ‚Üí StagesRendererMaterial ‚Üí StagesRenderer
```

## üí° **QUICK INTEGRATION EXAMPLES**

### **Basic Engine Usage**
```typescript
import { StagesEngine } from "./StagesEngine";

const engine = new StagesEngine({
  deviceTier: "auto", // or "low"/"mid"/"high"
  width: 2048,
  height: 2048
});

await engine.mount(containerElement);

engine.setObject("sprite1", {
  id: "sprite1",
  x: 1024, y: 1024, // center of 2048√ó2048 stage
  scale: 1.0,
  rotation: 0,
  texture: "./image.png"
});
```

### **React Integration**
```typescript
import { useLayerEngine } from "./useLayerEngine";

function MyComponent() {
  const engine = useLayerEngine({
    onMount: (engine) => {
      engine.setObject("logo", { x: 1024, y: 512 });
    }
  });
  
  return <div ref={engine.containerRef} />;
}
```

### **Custom Device Rules**
```typescript
// Extend StagesLogicDevice for custom detection
class CustomDeviceRules extends DeviceDetectionRules {
  detectTier(): "low" | "mid" | "high" {
    // Custom detection logic
    return "high";
  }
}
```

## üîç **KEY ARCHITECTURAL DIFFERENCES**

| Aspect | Upgraded System Approach |
|--------|-------------------------|
| **Stage Size** | 2048√ó2048 high-resolution virtual canvas |
| **Rendering** | Three.js WebGL with orthographic projection |
| **Architecture** | Modular coordination layer with child modules |
| **Performance** | Intelligent device detection with adaptive quality |
| **Coordinates** | Multi-system: Viewport ‚Üí Stage ‚Üí World conversion |
| **Logic Flow** | Coordination-based with update callbacks |
| **Configuration** | TypeScript interfaces with JSON validation |
| **Device Support** | Android-optimized with GPU intelligence |

## üéØ **EXTENSION GUIDELINES**

### **‚úÖ Easy to Extend**
- Add new device detection rules in `StagesLogicDevice.ts`
- Create new layer behaviors following `LayerLogic*.ts` pattern
- Extend configuration interfaces in type definition files
- Add new coordinate transformation modes in `StagesLogicTransform.ts`

### **‚ö†Ô∏è Moderate Complexity**
- Modify rendering pipeline in `StagesRenderer.ts`
- Add new coordination logic in `StagesLogic.ts`
- Extend event system in `StagesEngineEvents.ts`
- Create new mesh/material factories

### **üîí Core Architecture (Be Careful)**
- Main public API in `StagesEngine.ts`
- Core coordination logic in `StagesLogic.ts`
- Transform mathematics in `TransformRules` class
- Performance tier configurations

This file structure represents a **professional-grade 3D rendering system** designed for high-performance web applications with intelligent device adaptation, modular architecture, and comprehensive coordinate transformation capabilities.