<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stage Transform System Demo</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #222;
            color: white;
            overflow-x: hidden;
        }
        .demo-container {
            padding: 20px;
        }
        .demo-section {
            margin-bottom: 40px;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
        }
        .viewport-demo {
            position: relative;
            border: 2px solid #0088cc;
            margin: 20px 0;
            overflow: hidden;
        }
        .stage-canvas {
            background: linear-gradient(45deg, #ff006e, #8338ec);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        .coordinates {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        .info-panel {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .math-formula {
            background: #1a1a1a;
            padding: 10px;
            border-left: 4px solid #0088cc;
            margin: 10px 0;
            font-family: monospace;
        }
        .highlight { color: #ffaa00; }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üé≠ Stage Transform System - Interactive Demo</h1>
        
        <div class="demo-section">
            <h2>1. Fixed Canvas Concept (1024√ó1024)</h2>
            <p>The stage system uses a <strong>fixed virtual canvas</strong> of 1024√ó1024 pixels, regardless of actual screen size.</p>
            
            <div class="math-formula">
                <strong>Key Concept:</strong><br>
                ‚Ä¢ Virtual Stage: Always 1024√ó1024px<br>
                ‚Ä¢ Real Viewport: Variable (phone, tablet, desktop)<br>
                ‚Ä¢ Transform: Mathematical mapping between them
            </div>

            <div class="viewport-demo" style="width: 300px; height: 200px;" id="demo1">
                <div class="stage-canvas" style="width: 300px; height: 300px; transform: scale(0.67);">
                    1024√ó1024 Stage<br>
                    Scaled to fit 300√ó200
                </div>
                <div class="coordinates">Scale: 0.67</div>
            </div>
        </div>

        <div class="demo-section">
            <h2>2. Cover Scaling Mathematics</h2>
            <p>The system uses "cover" behavior - scale to fill viewport completely, cropping overflow.</p>
            
            <div class="math-formula">
                <strong>Cover Scale Calculation:</strong><br>
                scaleX = viewportWidth / 1024<br>
                scaleY = viewportHeight / 1024<br>
                <span class="highlight">finalScale = Math.max(scaleX, scaleY)</span> ‚Üê Use larger scale
            </div>

            <div id="scale-examples"></div>
        </div>

        <div class="demo-section">
            <h2>3. Coordinate Transformation</h2>
            <p>Converting mouse/touch coordinates from screen space to stage space.</p>
            
            <div class="math-formula">
                <strong>Coordinate Transform Formula:</strong><br>
                stageX = (clientX - offsetX) / scale<br>
                stageY = (clientY - offsetY) / scale<br><br>
                Where offsetX/Y centers the scaled stage in viewport
            </div>

            <div class="viewport-demo" style="width: 400px; height: 300px;" id="coord-demo">
                <div class="stage-canvas" id="interactive-stage">
                    Click anywhere!<br>
                    <span id="stage-coords">Stage: (0, 0)</span><br>
                    <span id="screen-coords">Screen: (0, 0)</span>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>4. Percentage-Based Positioning</h2>
            <p>Objects use percentage coordinates (0-100%) for consistent positioning across devices.</p>
            
            <div class="math-formula">
                <strong>Percentage to Pixels:</strong><br>
                actualX = (xPct / 100) * STAGE_WIDTH<br>
                actualY = (yPct / 100) * STAGE_HEIGHT<br><br>
                Example: 50% = 512px on 1024px stage
            </div>

            <div class="info-panel">
                <strong>Benefits:</strong><br>
                ‚úÖ Consistent layout across all screen sizes<br>
                ‚úÖ Designer works in fixed 1024√ó1024 canvas<br>
                ‚úÖ Automatic responsive behavior<br>
                ‚úÖ Precise control over positioning
            </div>
        </div>

        <div class="demo-section">
            <h2>5. Real-World Examples</h2>
            <div id="device-examples"></div>
        </div>
    </div>

    <script>
        // Demo 2: Scale Examples
        function createScaleExample(name, width, height) {
            const scaleX = width / 1024;
            const scaleY = height / 1024;
            const scale = Math.max(scaleX, scaleY);
            const scaledWidth = 1024 * scale;
            const scaledHeight = 1024 * scale;
            const offsetX = (width - scaledWidth) / 2;
            const offsetY = (height - scaledHeight) / 2;
            
            return `
                <div class="info-panel">
                    <strong>${name} (${width}√ó${height})</strong><br>
                    scaleX: ${scaleX.toFixed(3)} | scaleY: ${scaleY.toFixed(3)}<br>
                    <span class="highlight">Final Scale: ${scale.toFixed(3)}</span><br>
                    Scaled Size: ${scaledWidth.toFixed(0)}√ó${scaledHeight.toFixed(0)}<br>
                    Offset: ${offsetX.toFixed(0)}, ${offsetY.toFixed(0)}<br>
                    ${scaledWidth > width || scaledHeight > height ? '<span class="success">‚úÇÔ∏è Cropped to fit</span>' : '<span class="error">üìè Letterboxed</span>'}
                </div>
            `;
        }

        document.getElementById('scale-examples').innerHTML = 
            createScaleExample('iPhone (Portrait)', 375, 812) +
            createScaleExample('iPad', 1024, 1366) +
            createScaleExample('Desktop HD', 1920, 1080) +
            createScaleExample('Ultrawide', 3440, 1440);

        // Demo 3: Interactive Coordinates
        const coordDemo = document.getElementById('coord-demo');
        const interactiveStage = document.getElementById('interactive-stage');
        const stageCoords = document.getElementById('stage-coords');
        const screenCoords = document.getElementById('screen-coords');

        // Set up interactive stage
        const viewport = { width: 400, height: 300 };
        const scaleX = viewport.width / 1024;
        const scaleY = viewport.height / 1024;
        const scale = Math.max(scaleX, scaleY);
        const scaledWidth = 1024 * scale;
        const scaledHeight = 1024 * scale;
        const offsetX = (viewport.width - scaledWidth) / 2;
        const offsetY = (viewport.height - scaledHeight) / 2;

        interactiveStage.style.width = scaledWidth + 'px';
        interactiveStage.style.height = scaledHeight + 'px';
        interactiveStage.style.transform = `translate(${offsetX}px, ${offsetY}px)`;

        coordDemo.addEventListener('mousemove', (e) => {
            const rect = coordDemo.getBoundingClientRect();
            const clientX = e.clientX - rect.left;
            const clientY = e.clientY - rect.top;
            
            // Transform to stage coordinates
            const stageX = (clientX - offsetX) / scale;
            const stageY = (clientY - offsetY) / scale;
            
            screenCoords.textContent = `Screen: (${clientX.toFixed(0)}, ${clientY.toFixed(0)})`;
            stageCoords.textContent = `Stage: (${stageX.toFixed(0)}, ${stageY.toFixed(0)})`;
            
            // Show percentage
            const xPct = (stageX / 1024 * 100).toFixed(1);
            const yPct = (stageY / 1024 * 100).toFixed(1);
            interactiveStage.innerHTML = `
                Click anywhere!<br>
                <span id="stage-coords">Stage: (${stageX.toFixed(0)}, ${stageY.toFixed(0)})</span><br>
                <span id="screen-coords">Screen: (${clientX.toFixed(0)}, ${clientY.toFixed(0)})</span><br>
                <span style="color: #ffaa00">Percentage: (${xPct}%, ${yPct}%)</span>
            `;
        });

        // Demo 5: Device Examples
        function createDeviceExample(device, width, height, description) {
            const scaleX = width / 1024;
            const scaleY = height / 1024;
            const scale = Math.max(scaleX, scaleY);
            const scaledWidth = 1024 * scale;
            const scaledHeight = 1024 * scale;
            const offsetX = (width - scaledWidth) / 2;
            const offsetY = (height - scaledHeight) / 2;
            
            const cropX = scaledWidth > width ? scaledWidth - width : 0;
            const cropY = scaledHeight > height ? scaledHeight - height : 0;
            
            return `
                <div class="info-panel">
                    <strong>${device}</strong> - ${description}<br>
                    Viewport: ${width}√ó${height} | Scale: ${scale.toFixed(3)}<br>
                    Result: ${scaledWidth.toFixed(0)}√ó${scaledHeight.toFixed(0)} stage<br>
                    ${cropX > 0 ? `<span class="error">Crops ${cropX.toFixed(0)}px horizontally</span>` : ''}
                    ${cropY > 0 ? `<span class="error">Crops ${cropY.toFixed(0)}px vertically</span>` : ''}
                    ${cropX === 0 && cropY === 0 ? '<span class="success">Perfect fit!</span>' : ''}
                </div>
            `;
        }

        document.getElementById('device-examples').innerHTML = 
            createDeviceExample('iPhone 13', 390, 844, 'Tall portrait - crops top/bottom') +
            createDeviceExample('iPad Air', 820, 1180, 'Square-ish - minimal cropping') +
            createDeviceExample('MacBook Pro', 1512, 982, 'Landscape - crops left/right') +
            createDeviceExample('4K Monitor', 3840, 2160, 'Large landscape - heavy crop');
    </script>
</body>
</html>